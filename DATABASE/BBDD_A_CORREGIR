DROP DATABASE IF EXISTS PedalNest;
CREATE DATABASE PedalNest;
USE PedalNest;

CREATE TABLE Productos (
  IDProducto INT NOT NULL AUTO_INCREMENT,
  Nombre VARCHAR(255) NOT NULL,
  Descripcion VARCHAR(5000) NULL,
  Imagen VARCHAR(500) NULL,
  Precio DECIMAL(10,2) NOT NULL,
  Cantidad INT DEFAULT 0,
  Categoria VARCHAR(45) NULL,
  PRIMARY KEY (IDProducto)
);

CREATE TABLE Usuarios (
  IDUsuarios INT NOT NULL AUTO_INCREMENT,
  Nombre VARCHAR(45) NULL,
  Apellidos VARCHAR(45) NULL,
  Correo VARCHAR(100) NOT NULL UNIQUE,
  Pass VARCHAR(255) NOT NULL,
  CodPos VARCHAR(10) NULL,
  Poblacion VARCHAR(45) NULL,
  Direccion VARCHAR(255) NULL,
  Telefono VARCHAR(9) NULL,
  Movil VARCHAR(9) NULL,
  Notificaciones VARCHAR(1) DEFAULT 'N',
  ImgUsuario VARCHAR(255) NULL,
  PRIMARY KEY (IDUsuarios)
);

CREATE TABLE Comentarios (
  IDComentarios INT NOT NULL AUTO_INCREMENT,
  IDUsuario INT NULL,
  Nombre VARCHAR(45) NULL,
  Correo VARCHAR(100) NULL,
  Texto VARCHAR(2000) NOT NULL,
  FechaComentario TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (IDComentarios),
  FOREIGN KEY (IDUsuario) REFERENCES Usuarios(IDUsuarios) ON DELETE SET NULL
);

CREATE TABLE Reservas (
  IDReservas INT NOT NULL AUTO_INCREMENT,
  IDUsuario INT NOT NULL,
  Dia DATE NOT NULL,
  HoraEntrada TIME NOT NULL,
  HoraSalida TIME NOT NULL,
  Participantes INT DEFAULT 1,
  PRIMARY KEY (IDReservas),
  FOREIGN KEY (IDUsuario) REFERENCES Usuarios(IDUsuarios) ON DELETE CASCADE
);

CREATE TABLE Compra (
  IDCompra INT NOT NULL AUTO_INCREMENT,
  IDUsuario INT NOT NULL,
  Dia DATE NOT NULL,
  Hora TIME NOT NULL,
  Total DECIMAL(10,2) NOT NULL,
  PRIMARY KEY (IDCompra),
  FOREIGN KEY (IDUsuario) REFERENCES Usuarios(IDUsuarios) ON DELETE CASCADE
);

CREATE TABLE CompraProductos (
  ID INT NOT NULL AUTO_INCREMENT,
  IDCompra INT NOT NULL,
  IDProducto INT NOT NULL,
  Cantidad INT DEFAULT 1,
  PrecioUnitario DECIMAL(10,2) NOT NULL,
  PRIMARY KEY (ID),
  FOREIGN KEY (IDCompra) REFERENCES Compra(IDCompra) ON DELETE CASCADE,
  FOREIGN KEY (IDProducto) REFERENCES Productos(IDProducto) ON DELETE CASCADE
);